<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
	<title>Geeklog Ban Plugin.</title>
</head>

<body>
<h1><a href="https://github.com/Geeklog-Plugins/ban">Geeklog Ban Plugin v2.0.1</a></h1>
<p>Original Release Date: October 2003<br>
Original Author: Tom Willett<br>
Current Maintainers: <a href="https://github.com/orgs/Geeklog-Plugins/people" target="_blank">Geeklog Community Members</a></p>

<p>This plugin is designed for Geeklog version 2.1.1 or higher. It can also work with the <a href="https://github.com/Geeklog-Plugins">GUS plugin</a> version 1.7.3 or higher.</p>

<h2>FEATURES:</h2>

<p>The Ban plugin allows you to ban people and bots from your website.  You can ban a bot/user by IP, Referer, User Agent or Script Name.  Exact matches and case insensitive regular expressions (regex) are used to give you great flexibility.  The php preg_match function is used to do the regular expressions matches.</p>

<p>As of Ban plugin v2.0.1 it was decided to split up the attempt to determine an exact match from a regular expression for BAN items. The main reason for this deals with remote IP addresses. With the introduction of the BAN API which is used by the Forum and GUS plugins a lot more single IP addresses where being added to the BAN plugin. This reason along with the auto BAN functionality the BAN list was become very long. This means loading the BAN list and stepping through each item to do a preg_match became very time consuming and resulted in much longer page loads. With the spiting up of exact matches and regular expressions this means we can do a very quick search of the database for exact matches followed by checking each regular expression BAN item.</p>

<p>Why would you want to ban bots from your website?  There are at least three good reasons.</p>

<ol>
    <li>They eat up bandwidth and resources -- I have had bots come to my website and slurp every web page as fast as they can.  Numerous times I have recorded several hundred page accesses per minute by one ip or bot.</li>
    <li>You might not agree with what the bot is going to do with the information.  Three I ban are <a href="http://www.cyveillance.com/">Cyveillance</a>, <a href="http://www.nameprotect.com/">NameProtect</a>, and <a href="http://www.turnitin.com/static/index.html">Turnitin</a>.  If you are not familiar with them check them out.</li>
    <li>Privacy concerns dictate that I do what I can to ban email harvesters from my site.</li>
</ol>    
    
<p>All of these reasons and more are the reasons I ban certain bots.</p>

<p>Here are two links out of several that can give more background on the bot issues: 
<a href="http://diveintomark.org/archives/2003/02/26/how_to_block_spambots_ban_spybots_and_tell_unwanted_robots_to_go_to_hell">Mark Pilgrim's write up</a> and <a href="http://www.webmasterworld.com/forum13/687.htm">Webmaster World</a>.  The
later requires free registration but has a very good discussion and a more extensive block list.  Both of these websites use apache rewrite rules to ban bots but the Ban plugin will work anywhere Geeklog will and does not require fiddling with apache.  Both the apache rewrite rules and the Ban Plugin use regular expression matches and are thus compatible.</p>

<p>Briefly how the Ban Plugin works is it checks every page access against a list from your database of banned bots/users.  You can identify the person/bot to be banned by 4 different criteria: REMOTE_ADDR (this is the IP of the user/bot), HTTP_REFERER (obvious), HTTP_USER_AGENT (the browser of Agent String), and SCRIPT_NAME (the page being accessed).  These Ban Types are exact match and are very quick to search on. In addition to exact match you can specify a range or regular expression which allows you to ban multiple visitors with just one entry. These Ban Types are based on the 4 Ban Types listed above. Here is the full list of Ban Types:</p>


<p>Exact Matches Ban Types (case insensitive):</p>
<ul>
<li><strong>REMOTE_ADDR:</strong> Blocks a visitor from a specific IP address. Example: "<strong>192.168.1.123</strong>"</li>
<li><strong>HTTP_REFERER:</strong> Blocks a visitor that was referred by a specific URL</li>
<li><strong>HTTP_USER_AGENT:</strong> Blocks browsers that use a specific User Agent</li>
<li><strong>SCRIPT_NAME:</strong> Blocks a single page. Do not include domain. Example: "<strong>/article.php?story=test-story</strong>"</li>
</ul>

<p>Ban Types that use Regular Expressions and other Range Checks:</p>
<ul>
<li><strong>REMOTE_ADDR_RANGE:</strong> Easy to understand from and to IP ranges. Example: "<strong>63.148.99.224-63.148.99.255</strong>"</li>
<li><strong>REMOTE_ADDR_CIDR:</strong> Blocks a range of IPv4 addresses using CIDR notation. Does not support IPv6 addresses. Example: "<strong>192.168.100.14/24</strong>". For more information see <a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing" target="_blank">Classless Inter-Domain Routing</a>
<li><strong>REMOTE_ADDR_REGEX:</strong> Ban multiple IP range using a regular expression. Example: "<strong>^63\.148\.99\.2(2[4-9]|[3-4][0-9]|5[0-5])$</strong>"</li>
<li><strong>HTTP_REFERER_REGEX:</strong>  Ban visitors by HTTP_REFERER using a regular expression. Entering "<strong>example\.com</strong>" would ban any visitor that was referred from that domain (doesn't matter what page it was) </li>
<li><strong>HTTP_USER_AGENT_REGEX:</strong> Ban visitors by HTTP_USER_AGENT using a regular expression. For example if your ban was "<strong>badbot</strong>" any user agent that contained that text would be banned</li>
<li><strong>SCRIPT_NAME_REGEX:</strong> Blocks multiple pages. For example "<strong>article.php</strong>" would block any user from accessing any article.</li>
</ul>


Lets give a few more examples of how to use these.</p>

<p>Say I want to ban the bot/user from IP 192.168.0.2.  I would go to the Ban Admin page and enter REMOTE_ADDR_REGEX into the 'Ban Type' box and 192.168.0.2 into the 'Data' box.  But wait, this is a regular expression match so to keep from matching 192.168.0.20 etc I would need to enter 192.168.0.2$ to tell it that it was the end of the  IP string.  You might also want to add ^ to the beginning to signify that it starts at the beginning.  If you don't know regular expressions and you want to match the complete string put ^ at the start and $ at the end.  If you don't know regular expressions, now would be a good time to start learning.  <a href="http://www.regexlib.com/CheatSheet.htm">Here is a good cheat sheet</a> to jog your memory.</p>

<p>Here is a more complicated example I use to ban the Cyveillance bot:</p>

<p>I set the Ban Type again to REMOTE_ADDR_REGEX and the data to ^63\.148\.99\.2(2[4-9]|[3-4][0-9]|5[0-5])$ . This tells it to match the range 63.148.99.224 - 63.148.99.255 inclusive.</p>

<p>Another Example: say I want to ban the bot that has the HTTP_REFERER variable always set to a page that contains iaea.org.  I would set Ban Type to HTTP_REFERER_REGEX and Date to iaea\.org.  I had to escape the period because that is a special character in regexs.</p>

<p>Another Example: I want to ban various email harvesters.  I set Ban Type to HTTP_USER_AGENT_REGEX and Data to e?mail.?(collector|magnet|reaper|siphon|sweeper|harvest|collect|wolf). To say it simply it would match: email.collector, mail magnet, emailreaper, mailsiphon, etc, etc.</p>

<p>One final usage example:  I want to turn off a page on my website.  I would put SCRIPT_NAME in the Ban Type and the name of the page in Data.</p>

<p>Config.php in the plugins/ban/ directory has two variables that control options.</p>

<ul>
    <li>$_BAN_log Controls whether bans are logged to <geeklog>/logs/ban.log (same directory where your Geeklog error and access logs are.)</li>
    <li>$_BAN_page Setting this to a page will display that page when the bot/person is banned.  Setting it to '' will just
    display a blank page.  Caution do not set this to one of our Geeklog Pages or a refresh look will occur.  There is a sample 404.html
    page in the package you can use.</li>
</ul>

<p>Enjoy,</p>

<p>Tom</p>

</body>
</html>